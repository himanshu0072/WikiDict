# ============================================================================
# CLUSTER VARIABLES
# These define inputs for the shared EKS cluster
# ============================================================================

# -----------------------------------------------------------------------------
# GENERAL SETTINGS
# -----------------------------------------------------------------------------

variable "aws_region" {
  description = "AWS region where cluster will be created"
  type        = string
  default     = "eu-north-1"  # Stockholm - you chose this region
}

variable "service_name" {
  description = "Service name used for naming all resources"
  type        = string
  default     = "sm-wikidict"
}

# -----------------------------------------------------------------------------
# NETWORKING - VPC Configuration
# -----------------------------------------------------------------------------

variable "vpc_cidr" {
  description = "CIDR block for VPC (the IP range for your private network)"
  type        = string
  default     = "10.0.0.0/16"

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ WHAT IS CIDR?                                                        â”‚
  # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  # â”‚ CIDR = Classless Inter-Domain Routing                                â”‚
  # â”‚                                                                      â”‚
  # â”‚ Format: IP_ADDRESS/PREFIX_LENGTH                                     â”‚
  # â”‚                                                                      â”‚
  # â”‚ Example: 10.0.0.0/16                                                 â”‚
  # â”‚   - /16 means first 16 bits are fixed (the "10.0" part)             â”‚
  # â”‚   - Remaining 16 bits can vary (0.0 to 255.255)                     â”‚
  # â”‚   - Range: 10.0.0.0 to 10.0.255.255                                 â”‚
  # â”‚   - Total IPs: 2^16 = 65,536 addresses                              â”‚
  # â”‚                                                                      â”‚
  # â”‚ Common CIDR blocks:                                                  â”‚
  # â”‚   /16 = 65,536 IPs (large VPC)                                      â”‚
  # â”‚   /24 = 256 IPs (typical subnet)                                    â”‚
  # â”‚   /28 = 16 IPs (small subnet)                                       â”‚
  # â”‚                                                                      â”‚
  # â”‚ IMPORTANT: Subnet CIDRs must be WITHIN the VPC CIDR range!          â”‚
  # â”‚   VPC:    10.0.0.0/16    â†’ 10.0.0.0   to 10.0.255.255              â”‚
  # â”‚   Subnet: 10.0.1.0/24    â†’ 10.0.1.0   to 10.0.1.255   âœ“ Inside     â”‚
  # â”‚   Subnet: 10.1.0.0/24    â†’ 10.1.0.0   to 10.1.0.255   âœ— Outside!   â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
}

variable "availability_zones" {
  description = "List of AZs to use (spread across for high availability)"
  type        = list(string)
  default     = ["eu-north-1a", "eu-north-1b"]

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ WHAT ARE AVAILABILITY ZONES (AZs)?                                   â”‚
  # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  # â”‚ AZs = Separate data centers within a region                          â”‚
  # â”‚                                                                      â”‚
  # â”‚ Region: eu-north-1 (Stockholm)                                       â”‚
  # â”‚   â”œâ”€â”€ eu-north-1a  (Data Center A)                                  â”‚
  # â”‚   â”œâ”€â”€ eu-north-1b  (Data Center B)                                  â”‚
  # â”‚   â””â”€â”€ eu-north-1c  (Data Center C)                                  â”‚
  # â”‚                                                                      â”‚
  # â”‚ WHY USE MULTIPLE AZs?                                                â”‚
  # â”‚   - If one data center has power failure, fire, etc.                â”‚
  # â”‚   - Your app keeps running in the other AZ                          â”‚
  # â”‚   - This is called "High Availability" (HA)                         â”‚
  # â”‚                                                                      â”‚
  # â”‚ Example:                                                             â”‚
  # â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
  # â”‚   â”‚ eu-north-1a  â”‚     â”‚ eu-north-1b  â”‚                             â”‚
  # â”‚   â”‚   [Node 1]   â”‚     â”‚   [Node 2]   â”‚                             â”‚
  # â”‚   â”‚     âœ“        â”‚     â”‚     âœ“        â”‚                             â”‚
  # â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
  # â”‚                                                                      â”‚
  # â”‚   If eu-north-1a fails:                                             â”‚
  # â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
  # â”‚   â”‚ eu-north-1a  â”‚     â”‚ eu-north-1b  â”‚                             â”‚
  # â”‚   â”‚     âœ— DOWN   â”‚     â”‚   [Node 2]   â”‚ â† Still serving traffic!   â”‚
  # â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
  # â”‚                                                                      â”‚
  # â”‚ MINIMUM: 2 AZs for high availability                                 â”‚
  # â”‚ RECOMMENDED: 3 AZs for production workloads                         â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
}

variable "public_subnet_cidrs" {
  description = "CIDR blocks for public subnets (one per AZ)"
  type        = list(string)
  default     = ["10.0.1.0/24", "10.0.2.0/24"]

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ WHAT ARE PUBLIC SUBNETS?                                             â”‚
  # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  # â”‚                                                                      â”‚
  # â”‚ Public Subnet = Has direct route to Internet Gateway                 â”‚
  # â”‚                                                                      â”‚
  # â”‚   Internet                                                           â”‚
  # â”‚      â”‚                                                               â”‚
  # â”‚      â–¼                                                               â”‚
  # â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
  # â”‚ â”‚ Internet Gateway â”‚  â† Entry point from internet                   â”‚
  # â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
  # â”‚          â”‚                                                           â”‚
  # â”‚          â–¼                                                           â”‚
  # â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
  # â”‚ â”‚  Public Subnet   â”‚                                                â”‚
  # â”‚ â”‚                  â”‚                                                â”‚
  # â”‚ â”‚ â€¢ Load Balancers â”‚  â† Resources that need public IPs             â”‚
  # â”‚ â”‚ â€¢ NAT Gateways   â”‚  â† Allows private subnet to reach internet    â”‚
  # â”‚ â”‚ â€¢ Bastion hosts  â”‚  â† Jump servers for SSH access                â”‚
  # â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
  # â”‚                                                                      â”‚
  # â”‚ WHY 2 PUBLIC SUBNETS?                                                â”‚
  # â”‚   - One in each AZ for high availability                            â”‚
  # â”‚   - Load balancer needs subnets in multiple AZs                     â”‚
  # â”‚   - If one AZ fails, load balancer uses the other                   â”‚
  # â”‚                                                                      â”‚
  # â”‚ CIDR BREAKDOWN:                                                      â”‚
  # â”‚   10.0.1.0/24 = 10.0.1.0 to 10.0.1.255 (256 IPs) â†’ AZ-a            â”‚
  # â”‚   10.0.2.0/24 = 10.0.2.0 to 10.0.2.255 (256 IPs) â†’ AZ-b            â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
}

variable "private_subnet_cidrs" {
  description = "CIDR blocks for private subnets (one per AZ)"
  type        = list(string)
  default     = ["10.0.10.0/24", "10.0.11.0/24"]

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ WHAT ARE PRIVATE SUBNETS?                                            â”‚
  # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  # â”‚                                                                      â”‚
  # â”‚ Private Subnet = NO direct internet access (more secure)             â”‚
  # â”‚                                                                      â”‚
  # â”‚   Internet                                                           â”‚
  # â”‚      â”‚                                                               â”‚
  # â”‚      â–¼                                                               â”‚
  # â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
  # â”‚ â”‚ Internet Gateway â”‚                                                â”‚
  # â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
  # â”‚          â”‚                                                           â”‚
  # â”‚          â–¼                                                           â”‚
  # â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
  # â”‚ â”‚  Public Subnet   â”‚                                                â”‚
  # â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                                â”‚
  # â”‚ â”‚ â”‚ NAT Gateway  â”‚ â”‚  â† Outbound only (no inbound from internet)   â”‚
  # â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                                â”‚
  # â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
  # â”‚          â”‚                                                           â”‚
  # â”‚          â–¼                                                           â”‚
  # â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
  # â”‚ â”‚  Private Subnet  â”‚                                                â”‚
  # â”‚ â”‚                  â”‚                                                â”‚
  # â”‚ â”‚ â€¢ EKS Nodes      â”‚  â† Your application runs here                 â”‚
  # â”‚ â”‚ â€¢ Databases      â”‚  â† Sensitive resources hidden                 â”‚
  # â”‚ â”‚ â€¢ Internal APIs  â”‚  â† Not directly accessible                    â”‚
  # â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
  # â”‚                                                                      â”‚
  # â”‚ HOW DO PRIVATE RESOURCES ACCESS INTERNET?                            â”‚
  # â”‚   - Through NAT Gateway (Network Address Translation)               â”‚
  # â”‚   - NAT allows OUTBOUND (download packages, pull images)            â”‚
  # â”‚   - NAT blocks INBOUND (hackers can't directly reach your nodes)   â”‚
  # â”‚                                                                      â”‚
  # â”‚ WHY 2 PRIVATE SUBNETS?                                               â”‚
  # â”‚   - One in each AZ for high availability                            â”‚
  # â”‚   - EKS spreads nodes across subnets                                â”‚
  # â”‚   - If one AZ fails, nodes in other AZ continue                     â”‚
  # â”‚                                                                      â”‚
  # â”‚ CIDR BREAKDOWN:                                                      â”‚
  # â”‚   10.0.10.0/24 = 10.0.10.0 to 10.0.10.255 (256 IPs) â†’ AZ-a         â”‚
  # â”‚   10.0.11.0/24 = 10.0.11.0 to 10.0.11.255 (256 IPs) â†’ AZ-b         â”‚
  # â”‚                                                                      â”‚
  # â”‚ NOTE: We use 10.0.10.x instead of 10.0.3.x to leave room           â”‚
  # â”‚       for more public subnets if needed later (10.0.3-9.x)          â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
}

# -----------------------------------------------------------------------------
# EKS Configuration
# -----------------------------------------------------------------------------

variable "cluster_version" {
  description = "Kubernetes version for EKS"
  type        = string
  default     = "1.29"

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ KUBERNETES VERSION                                                   â”‚
  # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  # â”‚ AWS EKS supports ~4 Kubernetes versions at a time                    â”‚
  # â”‚                                                                      â”‚
  # â”‚ As of 2024:                                                          â”‚
  # â”‚   1.29 â† Current (recommended)                                      â”‚
  # â”‚   1.28                                                               â”‚
  # â”‚   1.27                                                               â”‚
  # â”‚   1.26 â† Approaching end of support                                 â”‚
  # â”‚                                                                      â”‚
  # â”‚ TIPS:                                                                â”‚
  # â”‚   - Don't use bleeding edge (might have bugs)                       â”‚
  # â”‚   - Don't use oldest (security risks, deprecations)                 â”‚
  # â”‚   - Plan upgrades every 6-12 months                                 â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
}

variable "node_instance_types" {
  description = "EC2 instance types for worker nodes"
  type        = list(string)
  default     = ["t3.small"]

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ EC2 INSTANCE TYPES FOR KUBERNETES                                    â”‚
  # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  # â”‚                                                                      â”‚
  # â”‚ Common instance types:                                               â”‚
  # â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
  # â”‚   â”‚ Type        â”‚ vCPU  â”‚ RAM    â”‚ ~Cost/month â”‚                   â”‚
  # â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
  # â”‚   â”‚ t3.small    â”‚ 2     â”‚ 2 GB   â”‚ $15         â”‚ â† Minimum for K8sâ”‚
  # â”‚   â”‚ t3.medium   â”‚ 2     â”‚ 4 GB   â”‚ $30         â”‚ â† Good for dev   â”‚
  # â”‚   â”‚ t3.large    â”‚ 2     â”‚ 8 GB   â”‚ $60         â”‚ â† Good for prod  â”‚
  # â”‚   â”‚ t3.xlarge   â”‚ 4     â”‚ 16 GB  â”‚ $120        â”‚                   â”‚
  # â”‚   â”‚ m5.large    â”‚ 2     â”‚ 8 GB   â”‚ $70         â”‚ â† No burst limit â”‚
  # â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
  # â”‚                                                                      â”‚
  # â”‚ WHY t3.medium?                                                       â”‚
  # â”‚   - Kubernetes needs ~1.5 GB RAM for system components              â”‚
  # â”‚   - t3.small (2 GB) leaves almost nothing for your apps             â”‚
  # â”‚   - t3.medium (4 GB) gives ~2.5 GB for your applications           â”‚
  # â”‚                                                                      â”‚
  # â”‚ t3 vs m5:                                                            â”‚
  # â”‚   - t3 = "burstable" (good for variable workloads, cheaper)        â”‚
  # â”‚   - m5 = "consistent" (good for steady workloads)                   â”‚
  # â”‚                                                                      â”‚
  # â”‚ FOR LEARNING: Use t3.small to save costs ($15 vs $30/node)          â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
}

variable "node_desired_size" {
  description = "Initial number of nodes when cluster is created"
  type        = number
  default     = 1

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ NODE SCALING: desired vs min vs max                                  â”‚
  # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  # â”‚                                                                      â”‚
  # â”‚                    Autoscaler Range                                  â”‚
  # â”‚    â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                 â”‚
  # â”‚                                                                      â”‚
  # â”‚    min=1          desired=2              max=5                       â”‚
  # â”‚    â”‚              â”‚                      â”‚                           â”‚
  # â”‚    â–¼              â–¼                      â–¼                           â”‚
  # â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
  # â”‚    1    2    3    4    5                                             â”‚
  # â”‚         â–²                                                            â”‚
  # â”‚         â”‚                                                            â”‚
  # â”‚    Starts here                                                       â”‚
  # â”‚                                                                      â”‚
  # â”‚ desired_size = 2                                                     â”‚
  # â”‚   â†’ When cluster is created, start with 2 nodes                     â”‚
  # â”‚   â†’ This is the "normal" operating state                            â”‚
  # â”‚                                                                      â”‚
  # â”‚ FLOW:                                                                â”‚
  # â”‚   1. Cluster created â†’ 2 nodes (desired)                            â”‚
  # â”‚   2. High traffic â†’ Autoscaler adds nodes â†’ up to 5 (max)          â”‚
  # â”‚   3. Low traffic â†’ Autoscaler removes nodes â†’ down to 1 (min)      â”‚
  # â”‚   4. Normal traffic â†’ Settles around 2 (desired)                    â”‚
  # â”‚                                                                      â”‚
  # â”‚ WHY 2 NODES?                                                         â”‚
  # â”‚   - 1 node = No redundancy (if it dies, app goes down)             â”‚
  # â”‚   - 2 nodes = Basic HA (one can fail, app survives)                â”‚
  # â”‚   - Spread across 2 AZs for datacenter-level redundancy            â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
}

variable "node_min_size" {
  description = "Minimum nodes - autoscaler will never go below this"
  type        = number
  default     = 1

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ MINIMUM NODES                                                        â”‚
  # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  # â”‚                                                                      â”‚
  # â”‚ The cluster autoscaler can remove nodes when they're idle           â”‚
  # â”‚ min_size prevents it from removing ALL nodes                        â”‚
  # â”‚                                                                      â”‚
  # â”‚ Set to 1 for learning/dev (saves cost during idle)                  â”‚
  # â”‚ Set to 2+ for production (ensures high availability)                â”‚
  # â”‚                                                                      â”‚
  # â”‚ WARNING: min=1 means during very low traffic:                       â”‚
  # â”‚   - You might have only 1 node                                      â”‚
  # â”‚   - If that node fails, brief downtime until new node starts       â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
}

variable "node_max_size" {
  description = "Maximum nodes - autoscaler will never exceed this"
  type        = number
  default     = 3

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ MAXIMUM NODES - COST PROTECTION!                                     â”‚
  # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  # â”‚                                                                      â”‚
  # â”‚ This is your SAFETY LIMIT against runaway costs                     â”‚
  # â”‚                                                                      â”‚
  # â”‚ Scenario without max limit:                                          â”‚
  # â”‚   - Bug causes infinite loop creating pods                          â”‚
  # â”‚   - Autoscaler keeps adding nodes                                   â”‚
  # â”‚   - Wake up to $10,000 AWS bill ğŸ˜±                                  â”‚
  # â”‚                                                                      â”‚
  # â”‚ With max_size = 3:                                                   â”‚
  # â”‚   - Maximum cost = 3 nodes Ã— $30/month = $90/month                  â”‚
  # â”‚   - Autoscaler stops at 3, pods stay pending                        â”‚
  # â”‚   - You get alerted, fix the bug, no surprise bill                  â”‚
  # â”‚                                                                      â”‚
  # â”‚ RECOMMENDATION:                                                      â”‚
  # â”‚   Learning/Dev: max = 3-5                                           â”‚
  # â”‚   Production: max = 10-20 (based on expected traffic)               â”‚
  # â”‚   Always set up billing alerts in AWS!                              â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
}

# -----------------------------------------------------------------------------
# ENVIRONMENTS - Namespaces to create
# -----------------------------------------------------------------------------

variable "environments" {
  description = "List of environments (will create namespace for each)"
  type        = list(string)
  default     = ["autoqa", "prod"]

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ KUBERNETES NAMESPACES                                                â”‚
  # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  # â”‚                                                                      â”‚
  # â”‚ Namespaces = Logical isolation within a cluster                     â”‚
  # â”‚                                                                      â”‚
  # â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  # â”‚ â”‚                    SINGLE EKS CLUSTER                           â”‚ â”‚
  # â”‚ â”‚                                                                  â”‚ â”‚
  # â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚ â”‚
  # â”‚ â”‚  â”‚  autoqa     â”‚  â”‚    pre      â”‚  â”‚    prod     â”‚            â”‚ â”‚
  # â”‚ â”‚  â”‚  namespace  â”‚  â”‚  namespace  â”‚  â”‚  namespace  â”‚            â”‚ â”‚
  # â”‚ â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚            â”‚ â”‚
  # â”‚ â”‚  â”‚ [pods]      â”‚  â”‚ [pods]      â”‚  â”‚ [pods]      â”‚            â”‚ â”‚
  # â”‚ â”‚  â”‚ [services]  â”‚  â”‚ [services]  â”‚  â”‚ [services]  â”‚            â”‚ â”‚
  # â”‚ â”‚  â”‚ [configs]   â”‚  â”‚ [configs]   â”‚  â”‚ [configs]   â”‚            â”‚ â”‚
  # â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ â”‚
  # â”‚ â”‚                                                                  â”‚ â”‚
  # â”‚ â”‚  Resources in one namespace are isolated from others            â”‚ â”‚
  # â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  # â”‚                                                                      â”‚
  # â”‚ BENEFITS:                                                            â”‚
  # â”‚   - Resource isolation (autoqa can't see prod secrets)             â”‚
  # â”‚   - Resource quotas (limit CPU/memory per namespace)               â”‚
  # â”‚   - RBAC (give dev team access to autoqa only)                     â”‚
  # â”‚   - Cost savings (one cluster instead of three)                    â”‚
  # â”‚                                                                      â”‚
  # â”‚ LIMITATIONS:                                                         â”‚
  # â”‚   - Not full isolation (share same nodes, network)                 â”‚
  # â”‚   - noisy neighbor problem (autoqa could affect prod)              â”‚
  # â”‚   - For strict isolation, use separate clusters                    â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
}

# -----------------------------------------------------------------------------
# TAGS
# -----------------------------------------------------------------------------

variable "tags" {
  description = "Additional tags for all resources"
  type        = map(string)
  default     = {}

  # â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  # â”‚ AWS RESOURCE TAGS                                                    â”‚
  # â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  # â”‚                                                                      â”‚
  # â”‚ Tags = Key-value labels attached to AWS resources                   â”‚
  # â”‚                                                                      â”‚
  # â”‚ Example:                                                             â”‚
  # â”‚   tags = {                                                           â”‚
  # â”‚     service_name     = "sm-wikidict"                                     â”‚
  # â”‚     Environment = "production"                                       â”‚
  # â”‚     Team        = "backend"                                          â”‚
  # â”‚     CostCenter  = "engineering"                                      â”‚
  # â”‚   }                                                                  â”‚
  # â”‚                                                                      â”‚
  # â”‚ USE CASES:                                                           â”‚
  # â”‚   1. Cost Tracking                                                  â”‚
  # â”‚      - Filter AWS bill by tag                                       â”‚
  # â”‚      - "How much does the backend team spend?"                      â”‚
  # â”‚                                                                      â”‚
  # â”‚   2. Resource Organization                                          â”‚
  # â”‚      - Find all resources for a service_name                            â”‚
  # â”‚      - aws ec2 describe-instances --filters "Name=tag:service_name,      â”‚
  # â”‚        Values=sm-wikidict"                                          â”‚
  # â”‚                                                                      â”‚
  # â”‚   3. Automation                                                      â”‚
  # â”‚      - Auto-shutdown dev resources at night                         â”‚
  # â”‚      - "Stop all instances where Environment=dev at 6pm"           â”‚
  # â”‚                                                                      â”‚
  # â”‚   4. Access Control                                                  â”‚
  # â”‚      - IAM policies can use tags                                    â”‚
  # â”‚      - "Allow delete only if Environment != production"             â”‚
  # â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
}
